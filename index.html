<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>VNB-Karte</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>html,body,#map{height:100%;margin:0}</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script>
const URL_TOPO = 'data/geo.topo.min.json';   // originaldatei (liegt bei dir)
const URL_CORE = 'data/vnb_core_map.json';   // id -> VNB-Name

// einfache, stabile farbe aus string
function colorFor(s){let h=0;for(let i=0;i<s.length;i++)h=(h*31+s.charCodeAt(i))>>>0;return `hsl(${h%360} 60% 60%)`;}

(async function(){
  // basis-checks
  if(typeof topojson==='undefined'){console.error('topojson-client fehlt'); return;}

  // daten laden
  const [topoRes, coreRes] = await Promise.all([fetch(URL_TOPO), fetch(URL_CORE)]);
  if(!topoRes.ok || !coreRes.ok){console.error('HTTP', topoRes.status, coreRes.status); return;}

  const topo = await topoRes.json();
  const core = await coreRes.json(); // {id: "VNB"}

  // richtiges objekt im topojson wählen (erstes objekt)
  const objKey = Object.keys(topo.objects || {})[0];
  if(!objKey){console.error('TopoJSON: objects leer'); return;}
  const geo = topojson.feature(topo, topo.objects[objKey]);

  if(!geo.features || !geo.features.length){console.error('keine features'); return;}

  // map
  const map = L.map('map', {minZoom:5, maxZoom:12}).setView([51.2,10.4],6);
  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OSM'}).addTo(map);

  // layer
  const layer = L.geoJSON(geo, {
    style: f=>{
      const id = (f.id || f.properties?.id || '').toString();
      const name = core[id] || 'unbekannt';
      return {color:'#000', weight:.25, fillOpacity:.85, fillColor:colorFor(name)};
    },
    onEachFeature:(f,l)=>{
      const id = (f.id || f.properties?.id || '').toString();
      const name = core[id] || 'unbekannt';
      l.bindPopup(`VNB: <b>${name}</b>`);
    }
  }).addTo(map);

  map.fitBounds(layer.getBounds(), {padding:[20,20]});
})().catch(e=>console.error(e));
</script>
</body>
</html>
