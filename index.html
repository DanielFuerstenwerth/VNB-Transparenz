<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>VNB-Polygone â€“ Farbtest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- TopoJSON â†’ GeoJSON -->
  <script src="https://unpkg.com/topojson-client@3"></script>
  <style>
    html, body, #map { height: 100%; margin: 0; }
    /* leichte â€Papierfarbeâ€œ, damit weiÃŸe FÃ¼llungen erkennbar sind */
    #map { background: #eef1f5; }
    .vnb-poly { stroke: #333; stroke-width: 1; fill-opacity: 0.75; }
    .vnb-poly:hover { stroke-width: 2; }
  </style>
</head>
<body>
<div id="map"></div>

<script>
(async function () {
  // 1) Karte ohne Basemap
  const map = L.map('map', { zoomControl: true });
  // neutraler Start: Deutschland grob â€“ wird gleich via fitBounds gesetzt
  map.setView([51.2, 10.4], 6);

  // 2) Daten laden (Pfadnamen ggf. anpassen)
  const [topo, farben] = await Promise.all([
    fetch('Polygone_ID.json').then(r => r.json()),
    fetch('farben.json').then(r => r.json())
  ]);

  // 3) TopoJSON â†’ GeoJSON
  //    Das Objekt heiÃŸt im TopoJSON "data" (FeatureCollection mit feature.id)
  const fc = topojson.feature(topo, topo.objects.data); // GeoJSON FeatureCollection

  // 4) Style-Funktion basierend auf feature.id (Fallback: properties.id)
  const getId = f => (f.id != null ? String(f.id) : String(f.properties?.id ?? ''));
  const getColor = id => farben[id] || '#cccccc'; // unbekannt: hellgrau

  const layer = L.geoJSON(fc, {
    style: feature => ({
      className: 'vnb-poly',
      color: '#333',
      weight: 1,
      fillColor: getColor(getId(feature)),
      fillOpacity: 0.75
    }),
    onEachFeature: (feature, l) => {
      const id = getId(feature);
      l.bindTooltip(`ID: ${id} | Farbe: ${getColor(id)}`, {sticky: true});
    }
  }).addTo(map);

  // 5) Karte passend zoomen
  try {
    map.fitBounds(layer.getBounds(), { padding: [10, 10] });
  } catch (e) {
    console.warn('fitBounds nicht mÃ¶glich â€“ ggf. keine Features?', e);
  }

  // 6) Diagnose: Abgleich IDs in Karte vs. farben.json
  const featureIds = new Set(fc.features.map(getId));
  const colorIds   = new Set(Object.keys(farben));

  let matched = 0, onlyInMap = 0, onlyInColors = 0;
  for (const id of featureIds) {
    if (colorIds.has(id)) matched++; else onlyInMap++;
  }
  for (const id of colorIds) {
    if (!featureIds.has(id)) onlyInColors++;
  }

  console.log('âœ… GeoJSON-Features:', fc.features.length);
  console.log('ğŸ¨ farben.json Keys:', colorIds.size);
  console.log('ğŸ”— ID-Matches:', matched);
  console.log('ğŸ—ºï¸  Nur in Polygone_ID.json (keine Farbe):', onlyInMap);
  console.log('ğŸ§¾ Nur in farben.json (kein Polygon):', onlyInColors);

  // ein paar Beispiele
  console.log('Beispiel-Feature-ID:', getId(fc.features[0]));
})();
</script>
</body>
</html>
