<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VNB-Polygone (D3, ohne Basemap)</title>

  <!-- D3 + topojson (nur diese zwei) -->
  <script src="https://unpkg.com/d3@7"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <style>
    html,body {height:100%; margin:0;}
    #wrap {height:100%; display:flex; flex-direction:column;}
    #map {flex:1; background:#f4f4f8;}
    svg {width:100%; height:100%; display:block;}
    .vnb { stroke:#222; stroke-width:0.4; fill-opacity:0.9; }
    .vnb:hover { stroke:#000; stroke-width:0.8; }
    #legend{padding:6px 10px; font:14px system-ui,Segoe UI,Roboto,Arial,sans-serif;}
    .chip{display:inline-block; width:12px; height:12px; margin-right:6px; vertical-align:middle;}
  </style>
</head>
<body>
<div id="wrap">
  <div id="legend">
    <span class="chip" style="background:#19a04b"></span> Wert = 1 (gr체n) &nbsp;&nbsp;
    <span class="chip" style="background:#d94b4b"></span> sonst (rot)
  </div>
  <div id="map"></div>
</div>

<script>
(async function () {
  const container = document.getElementById('map');

  // 1) Daten laden (Dateinamen exakt!)
  const topo = await fetch('Polygone.json').then(r => r.json());
  const colors = await fetch('farben.json').then(r => r.json()); // { "id": "1"|"0", ... }

  // TopoJSON -> GeoJSON (Objektnamen: erstes Objekt nehmen)
  const objName = Object.keys(topo.objects)[0];
  const geo = topojson.feature(topo, topo.objects[objName]); // Multi/Polygon-Features
  console.log('Features:', geo.features.length);

  // 2) SVG anlegen
  const w = container.clientWidth || 1200;
  const h = container.clientHeight || 800;
  const svg = d3.select(container).append('svg')
                .attr('viewBox', `0 0 ${w} ${h}`)
                .attr('preserveAspectRatio','xMidYMid meet');

  // 3) Projektion: Identit채t (Topo-Koordinaten), y spiegeln, auf SVG einpassen
  const proj = d3.geoIdentity().reflectY(true);
  const path = d3.geoPath(proj);

  // automatische Skalierung/Translation auf den verf체gbaren SVG-Raum:
  proj.fitSize([w, h], geo);

  // 4) Farbskala: "1" -> gr체n, sonst rot
  const colorFor = (id) => (colors[id] === "1" || colors[id] === 1) ? '#19a04b' : '#d94b4b';

  // 5) Zeichnen
  svg.append('g')
     .selectAll('path')
     .data(geo.features)
     .join('path')
     .attr('class','vnb')
     .attr('d', path)
     .attr('fill', d => colorFor(d.id ?? d.properties?.id))
     .append('title')
     .text(d => `VNB-ID: ${d.id ?? d.properties?.id}`);

  // optional: Bounding-Box anzeigen
  const b = path.bounds(geo);
  console.log('Bounds (Topo-Koordinaten, projiziert):', b);

})();
</script>
</body>
</html>
